var myApp=angular.module("myApp",["ngRoute"]);myApp.config(["$routeProvider",function(a){a.when("/in_theaters/:page?",{controller:"in_theaters_c",templateUrl:"template"}).when("/coming_soon/:page?",{controller:"coming_soon_c",templateUrl:"template"}).when("/top250/:page?",{controller:"top250_c",templateUrl:"template"}).when("/search/:text?/:page?",{controller:"search",templateUrl:"template"}).otherwise({redirectTo:"/in_theaters"})}]);myApp.service("HttpService",["$window","$document",function(b,a){this.jsonp=function(e,h,j){var g=Math.random().toString().replace(".","");var d="my_json_cb_"+g;b[d]=j;var c=e.indexOf("?")===-1?"?":"&";for(var f in h){c+=f+"="+h[f]+"&"}c+="callback="+d;var i=a[0].createElement("script");i.src=e+c;a[0].body.appendChild(i)}}]);myApp.service("MainService",[function(){function a(d){var c="";for(var e=0;e<d.length;e++){c+=d[e];if(e<d.length-1){c+="，"}}return c}function b(e){var c="";for(var d=0;d<e.length;d++){c+=e[d].name;if(d<e.length-1){c+="，"}}return c}this.pushArray=function(d,c){d.push({id:c.id,title:c.title,original_title:c.original_title,year:c.year,collect_count:c.collect_count,average:c.rating.average,directors:b(c.directors),casts:b(c.casts),genres:a(c.genres),img:c.images.large})};this.page_total=function(c,e){var f=parseInt(c);var d=f/e;if(f%e!==0){d=parseInt(d);d+=1}return d}}]);myApp.controller("class_focus",["$scope","$location",function(a,b){a.$location=b}]);myApp.controller("in_theaters_c",["$scope","HttpService","MainService","$routeParams",function(b,c,a,g){b.subjects_data=[];var e=10;var f=g["page"]?g["page"]:1;var d=parseInt(f);b.location="/in_theaters";b.page=d;b.last=d>1?d-1:d;var h=(f-1)*e+1;b.in_theaters_url="//api.douban.com/v2/movie/in_theaters?start="+h+"&count="+e;c.jsonp(b.in_theaters_url,{},function(j){b.total=a.page_total(j.total,e);b.next=d+1<=parseInt(b.total)?d+1:d;for(var l=0;l<j.subjects.length;l++){var k=j.subjects[l];a.pushArray(b.subjects_data,k);b.$apply()}})}]);myApp.controller("coming_soon_c",["$scope","MainService","HttpService","$routeParams",function(b,a,c,g){b.subjects_data=[];var e=10;var f=g["page"]?g["page"]:1;var d=parseInt(f);b.location="/coming_soon";b.page=d;b.last=d>1?d-1:d;var h=(f-1)*e+1;b.coming_soon_url="//api.douban.com/v2/movie/coming_soon?start="+h+"&count="+e;c.jsonp(b.coming_soon_url,{},function(j){b.total=a.page_total(j.total,e);b.next=d+1<=parseInt(b.total)?d+1:d;for(var l=0;l<j.subjects.length;l++){var k=j.subjects[l];a.pushArray(b.subjects_data,k);b.$apply()}})}]);myApp.controller("top250_c",["$scope","MainService","HttpService","$routeParams",function(b,a,c,g){b.subjects_data=[];var e=10;var f=g["page"]?g["page"]:1;var d=parseInt(f);b.location="/top250";b.page=d;b.last=d>1?d-1:d;var h=(f-1)*e+1;b.top250_url="//api.douban.com/v2/movie/top250?start="+h+"&count="+e;c.jsonp(b.top250_url,{},function(j){b.total=a.page_total(j.total,e);b.next=d+1<=parseInt(b.total)?d+1:d;for(var l=0;l<j.subjects.length;l++){var k=j.subjects[l];a.pushArray(b.subjects_data,k);b.$apply()}})}]);myApp.controller("search",["$scope","MainService","HttpService","$routeParams",function(i,f,c,g){i.subjects_data=[];i.text="";var h=g["text"];var d=10;var e=g["page"]?g["page"]:1;var a=parseInt(e);i.location="/search";i.page=a;i.last=a>1?a-1:a;var b=(e-1)*d+1;i.search_url="//api.douban.com/v2/movie/search?q="+h+"&start="+b+"&count="+d;c.jsonp(i.search_url,{},function(j){i.total=f.page_total(j.total,d);i.next=a+1<=parseInt(i.total)?a+1:a;for(var l=0;l<j.subjects.length;l++){var k=j.subjects[l];f.pushArray(i.subjects_data,k);i.$apply()}});i.search_sub=function(){window.location.href="#!/search/"+i.text}}]);